image: devmohe/debian-roswell

# git clone http://192.168.2.150/root/wiki.git && cd wiki && git checkout state-machine

variables:
  GIT_SUBMODULE_STRATEGY: recursive

stages:
  - build-and-test

cache:
  paths:
    - cache
    - roswell

before_script:
  - mkdir -p cache
  - mkdir -p roswell
  - cp -ruT cache/ ~/.cache/
  - cp -ruT roswell/ ~/.roswell/
  - ln -sf $PWD/{spickipedia,lack,parenscript,clack,cl-coveralls} ~/.roswell/local-projects/

after_script:
  - cp -ruT ~/.cache/ cache/
  - cp -ruT ~/.roswell/ roswell/

build-and-test:
  stage: build-and-test
  script:
    - ros -s prove -e '(or (prove:run :spickipedia-test) (uiop:quit -1))'
